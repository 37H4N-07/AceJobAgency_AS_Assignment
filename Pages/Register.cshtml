@page
@model AceJobAgency_AS_Assignment.Pages.RegisterModel
@{
    ViewData["Title"] = "Register";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h3>Create Your Account</h3>
                </div>
                <div class="card-body p-4">
                    <form method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="All" class="text-danger mb-3"></div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Input.FirstName" class="form-label">First Name</label>
                                <input asp-for="Input.FirstName" class="form-control" />
                                <span asp-validation-for="Input.FirstName" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="Input.LastName" class="form-label">Last Name</label>
                                <input asp-for="Input.LastName" class="form-control" />
                                <span asp-validation-for="Input.LastName" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Input.Gender" class="form-label">Gender</label>
                                <select asp-for="Input.Gender" class="form-control">
                                    <option value="">-- Select Gender --</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                                <span asp-validation-for="Input.Gender" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="Input.NRIC" class="form-label">NRIC</label>
                                <input asp-for="Input.NRIC" class="form-control" placeholder="S1234567A" />
                                <span asp-validation-for="Input.NRIC" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Email" class="form-label">Email Address</label>
                            <input asp-for="Input.Email" class="form-control" type="email" />
                            <span asp-validation-for="Input.Email" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Password" class="form-label">Password</label>
                            <input asp-for="Input.Password" class="form-control" type="password"
                                   id="Input_Password" onkeyup="validatePassword()" />
                            <span asp-validation-for="Input.Password" class="text-danger"></span>

                            <div class="progress mt-2" style="height: 20px;">
                                <div id="password-strength-bar" class="progress-bar" role="progressbar"
                                     style="width: 0%"></div>
                            </div>
                            <small id="password-strength-text" class="form-text"></small>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.ConfirmPassword" class="form-label">Confirm Password</label>
                            <input asp-for="Input.ConfirmPassword" class="form-control" type="password" />
                            <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.DateOfBirth" class="form-label">Date of Birth</label>
                            <input asp-for="Input.DateOfBirth" class="form-control" type="date" />
                            <span asp-validation-for="Input.DateOfBirth" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.Resume" class="form-label">Resume (.pdf or .docx)</label>
                            <input asp-for="Input.Resume" class="form-control" type="file" accept=".pdf,.docx" />
                            <span asp-validation-for="Input.Resume" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Input.WhoAmI" class="form-label">Who Am I (Optional)</label>
                            <textarea asp-for="Input.WhoAmI" class="form-control" rows="4" maxlength="2000"></textarea>
                            <span asp-validation-for="Input.WhoAmI" class="text-danger"></span>
                        </div>

                        <input type="hidden" id="recaptchaToken" name="RecaptchaToken" />

                        <button type="submit" class="btn btn-primary w-100 btn-lg">Register</button>

                        <div class="mt-3 text-center">
                            <p>Already have an account? <a asp-page="/Login">Login here</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/passwordValidator.js"></script>

    <script src="https://www.google.com/recaptcha/api.js?render=@Model.RecaptchaSiteKey"></script>
    <script>
        // Wait for reCAPTCHA to load
        grecaptcha.ready(function() {
            console.log('reCAPTCHA loaded successfully');

            // Get form
            const form = document.querySelector('form');

            form.addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent immediate submission

                console.log('Form submitted, generating reCAPTCHA token...');

                grecaptcha.execute('@Model.RecaptchaSiteKey', {action: 'register'}).then(function(token) {
                    console.log('reCAPTCHA token generated:', token.substring(0, 50) + '...');
                    document.getElementById('recaptchaToken').value = token;

                    // Now submit the form
                    form.submit();
                }).catch(function(error) {
                    console.error('reCAPTCHA error:', error);
                    alert('reCAPTCHA verification failed. Please refresh the page and try again.');
                });
            });
        });
    </script>
}