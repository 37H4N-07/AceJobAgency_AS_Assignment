@page
@model AceJobAgency_AS_Assignment.Pages.VerifyCodeModel
@{
    ViewData["Title"] = "Verify Code";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header text-white text-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h3>🔐 Verify Your Code</h3>
                </div>
                <div class="card-body p-4">
                    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                    {
                        <div class="alert alert-success">
                            @Model.SuccessMessage
                            @if (Model.CodeType == "Registration")
                            {
                                <div class="mt-3">
                                    <a asp-page="/Login" class="btn btn-success">Go to Login</a>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                        {
                            <div class="alert alert-danger">@Model.ErrorMessage</div>
                        }

                        <div class="alert alert-info">
                            <strong>📧 Check Your Email</strong>
                            <p class="mb-0">We've sent a 6-digit verification code to <strong>@Model.Email</strong></p>
                            <p class="mb-0 mt-2"><small>Code expires in 10 minutes</small></p>
                        </div>

                        <form method="post">
                            <input type="hidden" asp-for="Email" />
                            <input type="hidden" asp-for="CodeType" />

                            <div class="mb-4">
                                <label asp-for="Code" class="form-label">Enter 6-Digit Code</label>
                                <input asp-for="Code" class="form-control form-control-lg text-center"
                                       placeholder="000000" maxlength="6" autofocus
                                       style="letter-spacing: 1em; font-size: 1.8em; font-family: monospace;" />
                                <span asp-validation-for="Code" class="text-danger"></span>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 btn-lg mb-3">Verify Code</button>
                        </form>

                        <!-- Resend button OUTSIDE form -->
                        <form method="post" asp-page-handler="Resend">
                            <input type="hidden" name="Email" value="@Model.Email" />
                            <input type="hidden" name="CodeType" value="@Model.CodeType" />
                            <div class="text-center">
                                <button type="submit" class="btn btn-link">
                                    Didn't receive code? Resend
                                </button>
                            </div>
                        </form>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-focus and format code input
        const codeInput = document.querySelector('input[name="Code"]');
        if (codeInput) {
            codeInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
        }
    </script>
}